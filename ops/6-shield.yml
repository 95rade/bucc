- type: replace
  path: /instance_groups/name=bosh/jobs/name=director:before
  value:
    name: core
    release: shield
    properties:
      domain: ((internal_ip))
      port: 2443
      agent:
        key: ((shield-agent-key.private_key))
      tls:
        certificate: ((shield-tls.certificate))
        key:         ((shield-tls.private_key))
      vault:
        tls:
          ca:          ((vault-tls.ca))
          certificate: ((vault-tls.certificate))
          key:         ((vault-tls.private_key))
      failsafe:
        password: ((shield-admin-password))
      core:
        authentication:
        - identifier: uaa
          name:       UAA
          backend:    uaa
          properties:
            client_id:      shield_core
            client_secret:  ((shield_core_client_secret))
            uaa_endpoint:   https://((internal_ip)):8443
            skip_verify_tls: true

            mapping:
            - tenant: SYSTEM
              rights:
              - scim: bosh.admin
                role: admin
            - tenant: main
              rights:
              - scim: bosh.admin
                role: admin

- type: replace
  path: /instance_groups/name=bosh/jobs/-
  value:
    name: shield-agent
    release: shield
    properties:
      name: bucc-local
      shield-url: https://((internal_ip)):2443
      agent:
        key: ((shield-agent-key.public_key))
      core:
        ca: ((shield-tls.ca))

- type: replace
  path: /instance_groups/name=bosh/jobs/name=uaa/properties/uaa/clients/shield_core?
  value:
    id: shield_core
    secret: ((shield_core_client_secret))
    scope: openid
    authorities: uaa.none
    authorized-grant-types: "authorization_code"
    access-token-validity: 3600
    refresh-token-validity: 3600
    autoapprove: true
    override: true
    redirect-uri: https://((internal_ip)):2443/auth/uaa/redir

- type: replace
  path: /variables/-
  value: 
    name: shield-agent-key
    type: ssh

- type: replace
  path: /variables/-
  value: 
    name: shield_core_client_secret
    type: password

- type: replace
  path: /variables/-
  value: 
    name: shield-admin-password
    type: password

- type: replace
  path: /variables/-
  value: 
    name: shield-tls
    type: certificate
    options:
      ca: default_ca
      common_name: shield
      extended_key_usage:
        - client_auth
        - server_auth
      alternative_names:
        - 127.0.0.1
        - ((internal_ip))

- type: replace
  path: /variables/-
  value: 
    name: vault-ca
    type: certificate
    options:
      is_ca: true
      common_name: vaultca

- type: replace
  path: /variables/-
  value: 
    name: vault-tls
    type: certificate
    options:
      ca: vault-ca
      common_name: vault
      extended_key_usage:
        - client_auth
        - server_auth
      alternative_names:
        - 127.0.0.1

- type: replace
  path: /releases/-
  value:
    name: shield
    version: 8.0.4
    url: https://github.com/starkandwayne/shield-boshrelease/releases/download/v8.0.4/shield-8.0.4.tgz
    sha1: 4ffe8f8f8bd0051ab8dc24c48e94f3ff82a1e620