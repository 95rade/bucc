#!/usr/bin/env bash

set -e
set -o pipefail

pushd bucc > /dev/null

if [[ -z $(git config --global user.email) ]]; then
    git config --global user.email "ci@starkandwayne.com"
fi
if [[ -z $(git config --global user.name) ]]; then
    git config --global user.name "CI Bot"
fi

echo "CHECKING git status"
git status

echo "MERGE bosh-deployment repo with git subtree"
git remote add bosh-deployment ../bosh-deployment
git fetch bosh-deployment
git checkout -b bosh-deployment bosh-deployment/master
git read-tree --prefix=src/bosh-deployment -u bosh-deployment
git checkout develop
git merge --squash -s subtree bosh-deployment

popd > /dev/null

echo "CLONE repository"
git clone bucc bucc-out
